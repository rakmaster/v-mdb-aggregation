(function(P,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(P=typeof globalThis<"u"?globalThis:P||self,e(P.VMongoAggregationBuilder={},P.Vue))})(this,(function(P,e){"use strict";const ne=new Set(["$sum","$avg","$min","$max","$count","$first","$last","$push","$addToSet","$stdDevPop","$stdDevSamp"]),ae=new Set(["$addFields","$bucket","$bucketAuto","$changeStream","$changeStreamSplitLargeEvent","$collStats","$count","$currentOp","$densify","$documents","$facet","$fill","$geoNear","$graphLookup","$group","$indexStats","$limit","$listLocalSessions","$listSessions","$lookup","$match","$merge","$out","$planCacheStats","$project","$redact","$replaceRoot","$replaceWith","$sample","$search","$searchMeta","$set","$setWindowFields","$shardedDataDistribution","$skip","$sort","$sortByCount","$unionWith","$unset","$unwind"]);function re(d){const r={isValid:!0,errors:[],warnings:[]};let t;try{t=JSON.parse(d)}catch(g){return r.isValid=!1,r.errors.push({type:"json",message:`Invalid JSON: ${g instanceof Error?g.message:"Unknown parsing error"}`,position:{line:he(d,g),column:ye(d,g)}}),r}return Array.isArray(t)?(t.forEach((g,u)=>{oe(g,u,r)}),r.isValid=r.errors.length===0,me(t,r),r):(r.isValid=!1,r.errors.push({type:"structure",message:"Aggregation pipeline must be an array of stage objects"}),r)}function oe(d,r,t){if(typeof d!="object"||d===null||Array.isArray(d)){t.isValid=!1,t.errors.push({type:"structure",message:`Stage ${r+1} must be an object`,position:{stageIndex:r}});return}const g=Object.keys(d);g.length!==1&&(t.isValid=!1,t.errors.push({type:"structure",message:`Stage ${r+1} must have exactly one key (stage name)`,position:{stageIndex:r}}));const u=g[0];if(!u||!u.startsWith("$")){t.isValid=!1,t.errors.push({type:"stage",message:`Stage ${r+1}: Stage name "${u||"undefined"}" must start with $`,position:{stageIndex:r}});return}ae.has(u)||t.warnings.push({type:"compatibility",message:`Stage ${r+1}: Unrecognized stage "${u}" - may not be supported in all MongoDB versions`,position:{stageIndex:r}});const m=d[u];se(u,m,r,t)}function se(d,r,t,g){switch(d){case"$match":ie(r,t,g);break;case"$group":le(r,t,g);break;case"$project":case"$addFields":case"$set":ce(r,t,g);break;case"$sort":ue(r,t,g);break;case"$limit":case"$skip":pe(r,t,g);break;case"$unwind":de(r,t,g);break;case"$lookup":ge(r,t,g);break;default:fe(r,t,g)}}function ie(d,r,t){(typeof d!="object"||d===null)&&t.errors.push({type:"structure",message:`Stage ${r+1} ($match): Must be an object with query conditions`,position:{stageIndex:r}})}function le(d,r,t){if(typeof d!="object"||d===null){t.errors.push({type:"structure",message:`Stage ${r+1} ($group): Must be an object with _id and accumulator fields`,position:{stageIndex:r}});return}d.hasOwnProperty("_id")||t.errors.push({type:"structure",message:`Stage ${r+1} ($group): Missing required _id field`,position:{stageIndex:r}}),Object.entries(d).forEach(([g,u])=>{if(g!=="_id"&&typeof u=="object"&&u!==null){const m=Object.keys(u);if(m.length>0){const S=m[0];S&&S.startsWith("$")&&!ne.has(S)&&t.warnings.push({type:"compatibility",message:`Stage ${r+1} ($group): Unrecognized accumulator operator "${S}"`,position:{stageIndex:r}})}}})}function ce(d,r,t){(typeof d!="object"||d===null)&&t.errors.push({type:"structure",message:`Stage ${r+1}: Projection stage must be an object mapping field names to expressions`,position:{stageIndex:r}})}function ue(d,r,t){if(typeof d!="object"||d===null){t.errors.push({type:"structure",message:`Stage ${r+1} ($sort): Must be an object mapping field names to sort directions (1 or -1)`,position:{stageIndex:r}});return}Object.entries(d).forEach(([g,u])=>{u!==1&&u!==-1&&t.errors.push({type:"structure",message:`Stage ${r+1} ($sort): Field "${g}" must have sort direction 1 (ascending) or -1 (descending), got ${u}`,position:{stageIndex:r}})})}function pe(d,r,t){(typeof d!="number"||d<0||!Number.isInteger(d))&&t.errors.push({type:"structure",message:`Stage ${r+1}: Must be a non-negative integer`,position:{stageIndex:r}})}function de(d,r,t){typeof d=="string"?d.startsWith("$")||t.warnings.push({type:"best-practice",message:`Stage ${r+1} ($unwind): Field path should start with $`,position:{stageIndex:r}}):typeof d=="object"&&d!==null?d.path||t.errors.push({type:"structure",message:`Stage ${r+1} ($unwind): Missing required "path" field`,position:{stageIndex:r}}):t.errors.push({type:"structure",message:`Stage ${r+1} ($unwind): Must be a string field path or object with path property`,position:{stageIndex:r}})}function ge(d,r,t){if(typeof d!="object"||d===null){t.errors.push({type:"structure",message:`Stage ${r+1} ($lookup): Must be an object with lookup configuration`,position:{stageIndex:r}});return}d.from||t.errors.push({type:"structure",message:`Stage ${r+1} ($lookup): Missing required "from" field`,position:{stageIndex:r}}),d.as||t.errors.push({type:"structure",message:`Stage ${r+1} ($lookup): Missing required "as" field`,position:{stageIndex:r}})}function fe(d,r,t){d==null&&t.errors.push({type:"structure",message:`Stage ${r+1}: Stage value cannot be null or undefined`,position:{stageIndex:r}})}function me(d,r){const t=d.findIndex(m=>"$match"in m);t>0&&r.warnings.push({type:"performance",message:"Consider moving $match stage earlier in pipeline for better performance",position:{stageIndex:t}}),d.filter(m=>"$sort"in m).length>1&&r.warnings.push({type:"performance",message:"Multiple $sort stages detected - consider combining them",position:{}}),d.map((m,S)=>({stage:m,index:S})).filter(m=>"$limit"in m.stage).forEach(({stage:m,index:S})=>{let s=!1;for(let k=0;k<S;k++)if("$sort"in d[k]){s=!0;break}s||r.warnings.push({type:"best-practice",message:"$limit without preceding $sort may return unpredictable results",position:{stageIndex:S}})})}function he(d,r){if(r instanceof SyntaxError&&"message"in r){const t=r.message.match(/at position (\d+)/);if(t&&t[1]){const g=parseInt(t[1]);return d.substring(0,g).split(`
`).length}}}function ye(d,r){if(r instanceof SyntaxError&&"message"in r){const t=r.message.match(/at position (\d+)/);if(t&&t[1]){const g=parseInt(t[1]),u=d.substring(0,g).split(`
`),m=u[u.length-1];return m?m.length:void 0}}}var X=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function be(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var H={exports:{}},Y;function $e(){return Y||(Y=1,(function(d){var r=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{};var t=(function(g){var u=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,m=0,S={},s={manual:g.Prism&&g.Prism.manual,disableWorkerMessageHandler:g.Prism&&g.Prism.disableWorkerMessageHandler,util:{encode:function a(n){return n instanceof k?new k(n.type,a(n.content),n.alias):Array.isArray(n)?n.map(a):n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(a){return Object.prototype.toString.call(a).slice(8,-1)},objId:function(a){return a.__id||Object.defineProperty(a,"__id",{value:++m}),a.__id},clone:function a(n,i){i=i||{};var p,l;switch(s.util.type(n)){case"Object":if(l=s.util.objId(n),i[l])return i[l];p={},i[l]=p;for(var f in n)n.hasOwnProperty(f)&&(p[f]=a(n[f],i));return p;case"Array":return l=s.util.objId(n),i[l]?i[l]:(p=[],i[l]=p,n.forEach(function(c,o){p[o]=a(c,i)}),p);default:return n}},getLanguage:function(a){for(;a;){var n=u.exec(a.className);if(n)return n[1].toLowerCase();a=a.parentElement}return"none"},setLanguage:function(a,n){a.className=a.className.replace(RegExp(u,"gi"),""),a.classList.add("language-"+n)},currentScript:function(){if(typeof document>"u")return null;if(document.currentScript&&document.currentScript.tagName==="SCRIPT")return document.currentScript;try{throw new Error}catch(p){var a=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(p.stack)||[])[1];if(a){var n=document.getElementsByTagName("script");for(var i in n)if(n[i].src==a)return n[i]}return null}},isActive:function(a,n,i){for(var p="no-"+n;a;){var l=a.classList;if(l.contains(n))return!0;if(l.contains(p))return!1;a=a.parentElement}return!!i}},languages:{plain:S,plaintext:S,text:S,txt:S,extend:function(a,n){var i=s.util.clone(s.languages[a]);for(var p in n)i[p]=n[p];return i},insertBefore:function(a,n,i,p){p=p||s.languages;var l=p[a],f={};for(var c in l)if(l.hasOwnProperty(c)){if(c==n)for(var o in i)i.hasOwnProperty(o)&&(f[o]=i[o]);i.hasOwnProperty(c)||(f[c]=l[c])}var $=p[a];return p[a]=f,s.languages.DFS(s.languages,function(C,E){E===$&&C!=a&&(this[C]=f)}),f},DFS:function a(n,i,p,l){l=l||{};var f=s.util.objId;for(var c in n)if(n.hasOwnProperty(c)){i.call(n,c,n[c],p||c);var o=n[c],$=s.util.type(o);$==="Object"&&!l[f(o)]?(l[f(o)]=!0,a(o,i,null,l)):$==="Array"&&!l[f(o)]&&(l[f(o)]=!0,a(o,i,c,l))}}},plugins:{},highlightAll:function(a,n){s.highlightAllUnder(document,a,n)},highlightAllUnder:function(a,n,i){var p={callback:i,container:a,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};s.hooks.run("before-highlightall",p),p.elements=Array.prototype.slice.apply(p.container.querySelectorAll(p.selector)),s.hooks.run("before-all-elements-highlight",p);for(var l=0,f;f=p.elements[l++];)s.highlightElement(f,n===!0,p.callback)},highlightElement:function(a,n,i){var p=s.util.getLanguage(a),l=s.languages[p];s.util.setLanguage(a,p);var f=a.parentElement;f&&f.nodeName.toLowerCase()==="pre"&&s.util.setLanguage(f,p);var c=a.textContent,o={element:a,language:p,grammar:l,code:c};function $(E){o.highlightedCode=E,s.hooks.run("before-insert",o),o.element.innerHTML=o.highlightedCode,s.hooks.run("after-highlight",o),s.hooks.run("complete",o),i&&i.call(o.element)}if(s.hooks.run("before-sanity-check",o),f=o.element.parentElement,f&&f.nodeName.toLowerCase()==="pre"&&!f.hasAttribute("tabindex")&&f.setAttribute("tabindex","0"),!o.code){s.hooks.run("complete",o),i&&i.call(o.element);return}if(s.hooks.run("before-highlight",o),!o.grammar){$(s.util.encode(o.code));return}if(n&&g.Worker){var C=new Worker(s.filename);C.onmessage=function(E){$(E.data)},C.postMessage(JSON.stringify({language:o.language,code:o.code,immediateClose:!0}))}else $(s.highlight(o.code,o.grammar,o.language))},highlight:function(a,n,i){var p={code:a,grammar:n,language:i};if(s.hooks.run("before-tokenize",p),!p.grammar)throw new Error('The language "'+p.language+'" has no grammar.');return p.tokens=s.tokenize(p.code,p.grammar),s.hooks.run("after-tokenize",p),k.stringify(s.util.encode(p.tokens),p.language)},tokenize:function(a,n){var i=n.rest;if(i){for(var p in i)n[p]=i[p];delete n.rest}var l=new y;return v(l,l.head,a),N(a,l,n,l.head,0),x(l)},hooks:{all:{},add:function(a,n){var i=s.hooks.all;i[a]=i[a]||[],i[a].push(n)},run:function(a,n){var i=s.hooks.all[a];if(!(!i||!i.length))for(var p=0,l;l=i[p++];)l(n)}},Token:k};g.Prism=s;function k(a,n,i,p){this.type=a,this.content=n,this.alias=i,this.length=(p||"").length|0}k.stringify=function a(n,i){if(typeof n=="string")return n;if(Array.isArray(n)){var p="";return n.forEach(function($){p+=a($,i)}),p}var l={type:n.type,content:a(n.content,i),tag:"span",classes:["token",n.type],attributes:{},language:i},f=n.alias;f&&(Array.isArray(f)?Array.prototype.push.apply(l.classes,f):l.classes.push(f)),s.hooks.run("wrap",l);var c="";for(var o in l.attributes)c+=" "+o+'="'+(l.attributes[o]||"").replace(/"/g,"&quot;")+'"';return"<"+l.tag+' class="'+l.classes.join(" ")+'"'+c+">"+l.content+"</"+l.tag+">"};function F(a,n,i,p){a.lastIndex=n;var l=a.exec(i);if(l&&p&&l[1]){var f=l[1].length;l.index+=f,l[0]=l[0].slice(f)}return l}function N(a,n,i,p,l,f){for(var c in i)if(!(!i.hasOwnProperty(c)||!i[c])){var o=i[c];o=Array.isArray(o)?o:[o];for(var $=0;$<o.length;++$){if(f&&f.cause==c+","+$)return;var C=o[$],E=C.inside,L=!!C.lookbehind,B=!!C.greedy,G=C.alias;if(B&&!C.pattern.global){var R=C.pattern.toString().match(/[imsuy]*$/)[0];C.pattern=RegExp(C.pattern.source,R+"g")}for(var z=C.pattern||C,V=p.next,A=l;V!==n.tail&&!(f&&A>=f.reach);A+=V.value.length,V=V.next){var O=V.value;if(n.length>a.length)return;if(!(O instanceof k)){var J=1,T;if(B){if(T=F(z,A,a,L),!T||T.index>=a.length)break;var U=T.index,Te=T.index+T[0].length,j=A;for(j+=V.value.length;U>=j;)V=V.next,j+=V.value.length;if(j-=V.value.length,A=j,V.value instanceof k)continue;for(var D=V;D!==n.tail&&(j<Te||typeof D.value=="string");D=D.next)J++,j+=D.value.length;J--,O=a.slice(A,j),T.index-=A}else if(T=F(z,0,O,L),!T)continue;var U=T.index,q=T[0],I=O.slice(0,U),te=O.slice(U+q.length),Z=A+O.length;f&&Z>f.reach&&(f.reach=Z);var W=V.prev;I&&(W=v(n,W,I),A+=I.length),h(n,W,J);var Oe=new k(c,E?s.tokenize(q,E):q,G,q);if(V=v(n,W,Oe),te&&v(n,V,te),J>1){var K={cause:c+","+$,reach:Z};N(a,n,i,V.prev,A,K),f&&K.reach>f.reach&&(f.reach=K.reach)}}}}}}function y(){var a={value:null,prev:null,next:null},n={value:null,prev:a,next:null};a.next=n,this.head=a,this.tail=n,this.length=0}function v(a,n,i){var p=n.next,l={value:i,prev:n,next:p};return n.next=l,p.prev=l,a.length++,l}function h(a,n,i){for(var p=n.next,l=0;l<i&&p!==a.tail;l++)p=p.next;n.next=p,p.prev=n,a.length-=l}function x(a){for(var n=[],i=a.head.next;i!==a.tail;)n.push(i.value),i=i.next;return n}if(!g.document)return g.addEventListener&&(s.disableWorkerMessageHandler||g.addEventListener("message",function(a){var n=JSON.parse(a.data),i=n.language,p=n.code,l=n.immediateClose;g.postMessage(s.highlight(p,s.languages[i],i)),l&&g.close()},!1)),s;var w=s.util.currentScript();w&&(s.filename=w.src,w.hasAttribute("data-manual")&&(s.manual=!0));function b(){s.manual||s.highlightAll()}if(!s.manual){var _=document.readyState;_==="loading"||_==="interactive"&&w&&w.defer?document.addEventListener("DOMContentLoaded",b):window.requestAnimationFrame?window.requestAnimationFrame(b):window.setTimeout(b,16)}return s})(r);d.exports&&(d.exports=t),typeof X<"u"&&(X.Prism=t),t.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},t.languages.markup.tag.inside["attr-value"].inside.entity=t.languages.markup.entity,t.languages.markup.doctype.inside["internal-subset"].inside=t.languages.markup,t.hooks.add("wrap",function(g){g.type==="entity"&&(g.attributes.title=g.content.replace(/&amp;/,"&"))}),Object.defineProperty(t.languages.markup.tag,"addInlined",{value:function(u,m){var S={};S["language-"+m]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:t.languages[m]},S.cdata=/^<!\[CDATA\[|\]\]>$/i;var s={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:S}};s["language-"+m]={pattern:/[\s\S]+/,inside:t.languages[m]};var k={};k[u]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return u}),"i"),lookbehind:!0,greedy:!0,inside:s},t.languages.insertBefore("markup","cdata",k)}}),Object.defineProperty(t.languages.markup.tag,"addAttribute",{value:function(g,u){t.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+g+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[u,"language-"+u],inside:t.languages[u]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),t.languages.html=t.languages.markup,t.languages.mathml=t.languages.markup,t.languages.svg=t.languages.markup,t.languages.xml=t.languages.extend("markup",{}),t.languages.ssml=t.languages.xml,t.languages.atom=t.languages.xml,t.languages.rss=t.languages.xml,(function(g){var u=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;g.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+u.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+u.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+u.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+u.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:u,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},g.languages.css.atrule.inside.rest=g.languages.css;var m=g.languages.markup;m&&(m.tag.addInlined("style","css"),m.tag.addAttribute("style","css"))})(t),t.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},t.languages.javascript=t.languages.extend("clike",{"class-name":[t.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),t.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,t.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:t.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:t.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:t.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:t.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:t.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),t.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:t.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),t.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),t.languages.markup&&(t.languages.markup.tag.addInlined("script","javascript"),t.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),t.languages.js=t.languages.javascript,(function(){if(typeof t>"u"||typeof document>"u")return;Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var g="Loading…",u=function(w,b){return"✖ Error "+w+" while fetching file: "+b},m="✖ Error: File does not exist or is empty",S={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},s="data-src-status",k="loading",F="loaded",N="failed",y="pre[data-src]:not(["+s+'="'+F+'"]):not(['+s+'="'+k+'"])';function v(w,b,_){var a=new XMLHttpRequest;a.open("GET",w,!0),a.onreadystatechange=function(){a.readyState==4&&(a.status<400&&a.responseText?b(a.responseText):a.status>=400?_(u(a.status,a.statusText)):_(m))},a.send(null)}function h(w){var b=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(w||"");if(b){var _=Number(b[1]),a=b[2],n=b[3];return a?n?[_,Number(n)]:[_,void 0]:[_,_]}}t.hooks.add("before-highlightall",function(w){w.selector+=", "+y}),t.hooks.add("before-sanity-check",function(w){var b=w.element;if(b.matches(y)){w.code="",b.setAttribute(s,k);var _=b.appendChild(document.createElement("CODE"));_.textContent=g;var a=b.getAttribute("data-src"),n=w.language;if(n==="none"){var i=(/\.(\w+)$/.exec(a)||[,"none"])[1];n=S[i]||i}t.util.setLanguage(_,n),t.util.setLanguage(b,n);var p=t.plugins.autoloader;p&&p.loadLanguages(n),v(a,function(l){b.setAttribute(s,F);var f=h(b.getAttribute("data-range"));if(f){var c=l.split(/\r\n?|\n/g),o=f[0],$=f[1]==null?c.length:f[1];o<0&&(o+=c.length),o=Math.max(0,Math.min(o-1,c.length)),$<0&&($+=c.length),$=Math.max(0,Math.min($,c.length)),l=c.slice(o,$).join(`
`),b.hasAttribute("data-start")||b.setAttribute("data-start",String(o+1))}_.textContent=l,t.highlightElement(_)},function(l){b.setAttribute(s,N),_.textContent=l})}}),t.plugins.fileHighlight={highlight:function(b){for(var _=(b||document).querySelectorAll(y),a=0,n;n=_[a++];)t.highlightElement(n)}};var x=!1;t.fileHighlight=function(){x||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),x=!0),t.plugins.fileHighlight.highlight.apply(this,arguments)}})()})(H)),H.exports}var we=$e();const M=be(we);Prism.languages.json={property:{pattern:/(^|[^\\])"(?:\\.|[^\\"\r\n])*"(?=\s*:)/,lookbehind:!0,greedy:!0},string:{pattern:/(^|[^\\])"(?:\\.|[^\\"\r\n])*"(?!\s*:)/,lookbehind:!0,greedy:!0},comment:{pattern:/\/\/.*|\/\*[\s\S]*?(?:\*\/|$)/,greedy:!0},number:/-?\b\d+(?:\.\d+)?(?:e[+-]?\d+)?\b/i,punctuation:/[{}[\],]/,operator:/:/,boolean:/\b(?:false|true)\b/,null:{pattern:/\bnull\b/,alias:"keyword"}},Prism.languages.webmanifest=Prism.languages.json;const ve={class:"v-mab-syntax-highlighted-textarea"},xe=["textContent"],Q=e.defineComponent({__name:"JsonTextarea",props:{modelValue:{},placeholder:{default:""},rows:{default:10},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},textareaClass:{default:""}},emits:["update:modelValue"],setup(d,{emit:r}){const t=d,g=r,u=e.ref(t.modelValue),m=e.ref();e.computed(()=>{try{const y=JSON.parse(u.value||"{}");return JSON.stringify(y,null,2)}catch{return u.value||""}}),e.watch(()=>t.modelValue,y=>{u.value=y}),e.watch(u,y=>{g("update:modelValue",y)});const S=y=>{const h=y.target.textContent||"";u.value=h,clearTimeout(m.value),m.value=setTimeout(()=>{F()},100)},s=y=>{if(y.key==="Tab"){y.preventDefault();const v=y.target,h=window.getSelection();if(h&&h.rangeCount>0){const x=h.getRangeAt(0),w=document.createTextNode("  ");x.insertNode(w),x.setStartAfter(w),x.setEndAfter(w),h.removeAllRanges(),h.addRange(x),u.value=v.textContent||""}}},k=y=>{},F=()=>{const y=document.querySelector(".v-mab-syntax-textarea");if(!y)return;const v=y.textContent||"";if(!v.trim())return;let h=0;const x=window.getSelection();if(x&&x.rangeCount>0)try{const w=x.getRangeAt(0),b=w.cloneRange();b.selectNodeContents(y),b.setEnd(w.endContainer,w.endOffset),h=b.toString().length}catch{h=v.length}try{const w=JSON.parse(v),b=JSON.stringify(w,null,2),_=M.languages.json?M.highlight(b,M.languages.json,"json"):b;if(y.innerHTML=_,h>0)try{const a=N(y);let n=0,i=null,p=0;for(const l of a){if(n+l.textContent.length>=h){i=l,p=h-n;break}n+=l.textContent.length}if(i&&x){const l=document.createRange();l.setStart(i,Math.min(p,i.textContent.length)),l.setEnd(i,Math.min(p,i.textContent.length)),x.removeAllRanges(),x.addRange(l)}}catch(a){console.warn("Failed to restore cursor position:",a)}}catch{const w=M.languages.json?M.highlight(v,M.languages.json,"json"):v;y.innerHTML=w}},N=y=>{const v=[],h=document.createTreeWalker(y,NodeFilter.SHOW_TEXT,null);let x;for(;x=h.nextNode();)v.push(x);return v};return e.watch(u,()=>{e.nextTick(()=>{m.value||F()})},{immediate:!0}),e.onUnmounted(()=>{m.value&&(clearTimeout(m.value),m.value=0)}),(y,v)=>(e.openBlock(),e.createElementBlock("div",ve,[e.createElementVNode("div",{contenteditable:"true",class:e.normalizeClass(["v-mab-syntax-textarea",d.textareaClass]),onInput:S,onKeydown:s,onScroll:k,spellcheck:"false",textContent:e.toDisplayString(u.value)},null,42,xe)]))}}),Se={class:"stage-number"},ke={class:"v-mab-preview-box"},_e={class:"v-mab-preview-box-content"},Ce=e.defineComponent({__name:"VStageCard",props:{stage:{},index:{},totalStages:{}},emits:["update","delete","move-up","move-down"],setup(d,{emit:r}){const t=d,g=r,u=e.ref(""),m=e.ref(""),S=e.ref([]),s=[{title:"$match",value:"$match"},{title:"$group",value:"$group"},{title:"$project",value:"$project"},{title:"$sort",value:"$sort"},{title:"$limit",value:"$limit"},{title:"$skip",value:"$skip"},{title:"$count",value:"$count"},{title:"$unwind",value:"$unwind"},{title:"$lookup",value:"$lookup"},{title:"$addFields",value:"$addFields"},{title:"$set",value:"$set"},{title:"$unset",value:"$unset"},{title:"$replaceRoot",value:"$replaceRoot"},{title:"$facet",value:"$facet"},{title:"$bucket",value:"$bucket"},{title:"$bucketAuto",value:"$bucketAuto"},{title:"$sortByCount",value:"$sortByCount"},{title:"$graphLookup",value:"$graphLookup"},{title:"$unionWith",value:"$unionWith"},{title:"$search",value:"$search"},{title:"$searchMeta",value:"$searchMeta"},{title:"$out",value:"$out"},{title:"$merge",value:"$merge"}],k=e.computed(()=>S.value.length>0),F=e.computed(()=>{try{return JSON.parse(m.value)}catch{return null}}),N=v=>{try{const h=JSON.parse(m.value),x={[v]:h[Object.keys(h)[0]]||{}};m.value=JSON.stringify(x,null,2),y()}catch{const h={[v]:{}};m.value=JSON.stringify(h,null,2),y()}},y=()=>{try{const v=JSON.parse(m.value);g("update",t.index,v)}catch{S.value=["Invalid JSON syntax"]}};return e.watch(()=>t.stage,v=>{u.value=Object.keys(v)[0]||"",m.value=JSON.stringify(v,null,2),S.value=[]},{immediate:!0}),e.watch(m,()=>{S.value=[],y()}),(v,h)=>{const x=e.resolveComponent("v-col"),w=e.resolveComponent("v-chip"),b=e.resolveComponent("v-select"),_=e.resolveComponent("v-btn"),a=e.resolveComponent("v-btn-group"),n=e.resolveComponent("v-row"),i=e.resolveComponent("v-expansion-panel-title"),p=e.resolveComponent("v-alert"),l=e.resolveComponent("v-expansion-panel-text"),f=e.resolveComponent("v-expansion-panel");return e.openBlock(),e.createBlock(f,null,{default:e.withCtx(()=>[e.createVNode(i,null,{default:e.withCtx(()=>[e.createVNode(n,{align:"center"},{default:e.withCtx(()=>[e.createVNode(x,{cols:"auto"},{default:e.withCtx(()=>[e.createElementVNode("span",Se,"Stage "+e.toDisplayString(d.index+1),1)]),_:1}),e.createVNode(x,{cols:"auto"},{default:e.withCtx(()=>[e.createVNode(w,{size:"small",color:"primary",variant:"outlined"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(u.value||"Select Type"),1)]),_:1})]),_:1}),e.createVNode(x,null,{default:e.withCtx(()=>[e.createVNode(b,{modelValue:u.value,"onUpdate:modelValue":[h[0]||(h[0]=c=>u.value=c),N],items:s,label:"Stage Type",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e.createVNode(x,{cols:"auto"},{default:e.withCtx(()=>[e.createVNode(a,null,{default:e.withCtx(()=>[d.index>0?(e.openBlock(),e.createBlock(_,{key:0,icon:"mdi-arrow-up",size:"small",variant:"text",onClick:h[1]||(h[1]=e.withModifiers(c=>v.$emit("move-up",d.index),["stop"]))})):e.createCommentVNode("",!0),d.index<d.totalStages-1?(e.openBlock(),e.createBlock(_,{key:1,icon:"mdi-arrow-down",size:"small",variant:"text",onClick:h[2]||(h[2]=e.withModifiers(c=>v.$emit("move-down",d.index),["stop"]))})):e.createCommentVNode("",!0),e.createVNode(_,{icon:"mdi-delete-outline",size:"small",color:"error",variant:"text",onClick:h[3]||(h[3]=e.withModifiers(c=>v.$emit("delete",d.index),["stop"]))})]),_:1})]),_:1})]),_:1})]),_:1}),e.createVNode(l,null,{default:e.withCtx(()=>[k.value?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(S.value,c=>(e.openBlock(),e.createBlock(p,{key:c,type:"error",density:"compact",class:"mb-1"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(c),1)]),_:2},1024))),128)):e.createCommentVNode("",!0),e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(x,{cols:"12",md:"8"},{default:e.withCtx(()=>[e.createVNode(Q,{modelValue:m.value,"onUpdate:modelValue":h[4]||(h[4]=c=>m.value=c),class:e.normalizeClass({"text-error":k.value}),label:"Stage Configuration (JSON)",placeholder:'{"$match": {"status": "active"}}',rows:8},null,8,["modelValue","class"])]),_:1}),e.createVNode(x,{cols:"12",md:"4"},{default:e.withCtx(()=>[e.createElementVNode("div",ke,[h[5]||(h[5]=e.createElementVNode("div",{class:"v-mab-preview-box-label"}," Preview ",-1)),e.createElementVNode("div",_e,[e.createElementVNode("pre",null,e.toDisplayString(JSON.stringify(F.value,null,2)),1)])])]),_:1})]),_:1})]),_:1})]),_:1})}}}),ee=(d,r)=>{const t=d.__vccOpts||d;for(const[g,u]of r)t[g]=u;return t},Ae=ee(Ce,[["__scopeId","data-v-d6bb770e"]]),Fe=ee(e.defineComponent({__name:"VOutputPanel",props:{pipeline:{}},emits:["export"],setup(d,{emit:r}){const t=d,g=e.ref("json"),u=e.computed(()=>JSON.stringify(t.pipeline,null,2)),m=e.computed(()=>`db.collection.aggregate(${JSON.stringify(t.pipeline,null,2)})`);return(S,s)=>{const k=e.resolveComponent("v-spacer"),F=e.resolveComponent("v-btn"),N=e.resolveComponent("v-card-title"),y=e.resolveComponent("v-tab"),v=e.resolveComponent("v-tabs"),h=e.resolveComponent("v-window-item"),x=e.resolveComponent("v-window"),w=e.resolveComponent("v-card-text"),b=e.resolveComponent("v-card"),_=e.resolveComponent("v-col"),a=e.resolveComponent("v-row");return e.openBlock(),e.createBlock(a,null,{default:e.withCtx(()=>[e.createVNode(_,null,{default:e.withCtx(()=>[e.createVNode(b,null,{default:e.withCtx(()=>[e.createVNode(N,{class:"d-flex align-center"},{default:e.withCtx(()=>[s[4]||(s[4]=e.createElementVNode("span",null,"Output",-1)),e.createVNode(k),e.createVNode(F,{onClick:s[0]||(s[0]=n=>S.$emit("export")),size:"small"},{default:e.withCtx(()=>[...s[3]||(s[3]=[e.createTextVNode(" Export ",-1)])]),_:1})]),_:1}),e.createVNode(w,null,{default:e.withCtx(()=>[e.createVNode(v,{modelValue:g.value,"onUpdate:modelValue":s[1]||(s[1]=n=>g.value=n),color:"primary"},{default:e.withCtx(()=>[e.createVNode(y,{value:"json"},{default:e.withCtx(()=>[...s[5]||(s[5]=[e.createTextVNode("JSON",-1)])]),_:1}),e.createVNode(y,{value:"query"},{default:e.withCtx(()=>[...s[6]||(s[6]=[e.createTextVNode("Query",-1)])]),_:1})]),_:1},8,["modelValue"]),e.createVNode(x,{modelValue:g.value,"onUpdate:modelValue":s[2]||(s[2]=n=>g.value=n),class:"mt-4"},{default:e.withCtx(()=>[e.createVNode(h,{value:"json"},{default:e.withCtx(()=>[e.createElementVNode("pre",null,e.toDisplayString(u.value),1)]),_:1}),e.createVNode(h,{value:"query"},{default:e.withCtx(()=>[e.createElementVNode("pre",null,e.toDisplayString(m.value),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-b28ddba9"]]),Ve={key:0,class:"validation-errors mt-2"},Ne={class:"d-flex align-center mb-2"},Ee=e.defineComponent({__name:"VMongoAggregationBuilder",props:{initialPipeline:{default:()=>[]}},emits:["pipelineChange","exportPipeline"],setup(d,{emit:r}){const t=d,g=r,u=e.ref(t.initialPipeline||[]),m=e.ref("stages"),S=e.ref(""),s=e.ref([]),k=e.computed(()=>s.value.length>0),F=e.ref(t.initialPipeline?t.initialPipeline.map((c,o)=>o):[]),N=e.ref(JSON.stringify(t.initialPipeline||[],null,2)),y=e.computed(()=>JSON.stringify(u.value,null,2));e.watch(u,()=>{m.value==="text"&&(N.value=y.value)},{deep:!0}),e.watch(m,c=>{c==="text"&&(N.value=y.value)});const v=[{title:"Stages View",value:"stages"},{title:"Text View",value:"text"}],h=()=>{g("exportPipeline",u.value)},x=()=>{g("pipelineChange",u.value)},w=()=>{u.value.length,u.value.push({$match:{status:"active"}}),x()},b=()=>{F.value=u.value.map((c,o)=>o)},_=()=>{F.value=[]},a=c=>{u.value.splice(c,1),F.value=F.value.filter(o=>o!==c).map(o=>o>c?o-1:o),f(y.value),x()},n=(c,o)=>{u.value[c]=o,f(y.value),x()},i=c=>{if(c>0){[u.value[c-1],u.value[c]]=[u.value[c],u.value[c-1]];const o=[...F.value],$=o.indexOf(c),C=o.indexOf(c-1);$!==-1&&(o[$]=c-1),C!==-1&&(o[C]=c),F.value=o,f(y.value),x()}},p=c=>{if(c<u.value.length-1){[u.value[c],u.value[c+1]]=[u.value[c+1],u.value[c]];const o=[...F.value],$=o.indexOf(c),C=o.indexOf(c+1);$!==-1&&(o[$]=c+1),C!==-1&&(o[C]=c),F.value=o,f(y.value),x()}},l=()=>{f(N.value)},f=c=>{if(s.value=[],!!c.trim())try{const o=JSON.parse(c);if(!Array.isArray(o)){s.value.push("Aggregation pipeline must be an array of stage objects");return}const $=re(c);$.isValid||(s.value=$.errors.map(C=>C.message)),$.warnings.length>0&&$.warnings.forEach(C=>{s.value.push(`Warning: ${C.message}`)})}catch{s.value=["Invalid JSON syntax"]}};return(c,o)=>{const $=e.resolveComponent("v-btn"),C=e.resolveComponent("v-btn-toggle"),E=e.resolveComponent("v-spacer"),L=e.resolveComponent("v-toolbar"),B=e.resolveComponent("v-alert"),G=e.resolveComponent("v-expansion-panels"),R=e.resolveComponent("v-col"),z=e.resolveComponent("v-row"),V=e.resolveComponent("v-sheet");return e.openBlock(),e.createBlock(V,null,{default:e.withCtx(()=>[e.createVNode(z,null,{default:e.withCtx(()=>[e.createVNode(R,{cols:"12",md:"8"},{default:e.withCtx(()=>[e.renderSlot(c.$slots,"toolbar",{stages:u.value,viewMode:m.value,addStage:w,expandAllStages:b,collapseAllStages:_,exportPipeline:h,viewModeOptions:v},()=>[e.createVNode(L,null,{default:e.withCtx(()=>[e.renderSlot(c.$slots,"toolbar-prepend"),e.createVNode($,{onClick:w,class:"mx-3"},{default:e.withCtx(()=>[...o[3]||(o[3]=[e.createTextVNode(" Add Stage ",-1)])]),_:1}),e.createVNode(C,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=A=>m.value=A),label:"View Mode"},{default:e.withCtx(()=>[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(v,A=>e.createVNode($,{key:A.value,value:A.value},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(A.title),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"]),e.createVNode(E),m.value==="stages"?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createVNode($,{onClick:b,icon:"mdi-chevron-down"}),e.createVNode($,{onClick:_,icon:"mdi-chevron-up"})],64)):e.createCommentVNode("",!0),e.renderSlot(c.$slots,"toolbar-append")]),_:3})]),e.renderSlot(c.$slots,"validation",{errors:s.value,hasErrors:k.value,error:S.value},()=>[k.value?(e.openBlock(),e.createElementBlock("div",Ve,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,A=>(e.openBlock(),e.createBlock(B,{key:A,type:"error",density:"compact",class:"mb-1"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(A),1)]),_:2},1024))),128))])):e.createCommentVNode("",!0),S.value?(e.openBlock(),e.createBlock(B,{key:1,type:"error",class:"mt-4"},{default:e.withCtx(()=>[o[4]||(o[4]=e.createElementVNode("strong",null,"Error:",-1)),e.createTextVNode(" "+e.toDisplayString(S.value),1)]),_:1})):e.createCommentVNode("",!0)]),m.value==="stages"?(e.openBlock(),e.createBlock(G,{key:0,modelValue:F.value,"onUpdate:modelValue":o[1]||(o[1]=A=>F.value=A),multiple:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,(A,O)=>(e.openBlock(),e.createBlock(Ae,{key:O,stage:A,index:O,"total-stages":u.value.length,onUpdate:n,onDelete:a,onMoveUp:i,onMoveDown:p},null,8,["stage","index","total-stages"]))),128))]),_:1},8,["modelValue"])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("div",Ne,[e.createVNode(E),e.createVNode($,{size:"small",onClick:l,color:"primary",variant:"outlined"},{default:e.withCtx(()=>[...o[5]||(o[5]=[e.createTextVNode(" Validate ",-1)])]),_:1})]),e.createVNode(Q,{modelValue:N.value,"onUpdate:modelValue":o[2]||(o[2]=A=>N.value=A),class:e.normalizeClass({"text-error":k.value}),label:"Aggregation Pipeline JSON",placeholder:"Paste your aggregation pipeline JSON here...",rows:15},null,8,["modelValue","class"])],64))]),_:3}),e.createVNode(R,{cols:"12",md:"4"},{default:e.withCtx(()=>[e.createVNode(Fe,{pipeline:u.value,onExport:h},null,8,["pipeline"]),e.renderSlot(c.$slots,"output",{pipeline:u.value})]),_:3})]),_:3})]),_:3})}}});P.VMongoAggregationBuilder=Ee,Object.defineProperty(P,Symbol.toStringTag,{value:"Module"})}));
